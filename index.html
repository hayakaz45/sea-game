<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>海の生き物キャッチ（スマホ対応版）</title>

<style>
body {
  margin:0;
  overflow:hidden;
  touch-action:none;
  font-family:sans-serif;
  background:linear-gradient(#4fc3f7,#01579b);
}

#game {
  position:relative;
  width:100vw;
  height:100vh;
}

#score,#timer,#level {
  position:absolute;
  top:10px;
  color:white;
  font-size:20px;
  z-index:10;
}
#score{left:10px;}
#timer{right:10px;}
#level{left:50%; transform:translateX(-50%);}

.fish {
  position:absolute;
  font-size:clamp(40px,8vw,80px); /* ←スマホ用に大きく */
  cursor:pointer;
}

.bubble {
  position:absolute;
  bottom:-50px;
  animation:rise linear forwards;
}
@keyframes rise {
  to { transform:translateY(-110vh); opacity:0; }
}

#overlay {
  position:absolute;
  width:100%;
  height:100%;
  background:rgba(0,0,50,0.7);
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:white;
  z-index:20;
}

button {
  padding:15px 30px;
  font-size:20px;
  border:none;
  border-radius:10px;
  background:#00c3ff;
  color:white;
}

.score-popup {
  position:absolute;
  font-weight:bold;
  font-size:20px;
  pointer-events:none;
  animation:floatUp 1s ease-out forwards;
}
.plus { color:#00ffcc; }
.minus { color:#ff4d4d; }

@keyframes floatUp {
  from { transform:translateY(0); opacity:1; }
  to { transform:translateY(-60px); opacity:0; }
}
</style>
</head>

<body>

<div id="game">
  <div id="score">0</div>
  <div id="timer">30</div>
  <div id="level">Lv1</div>

  <div id="overlay">
    <h1>?? タップでキャッチ！</h1>
    <button onclick="startGame()">スタート</button>
  </div>
</div>

<audio id="good" src="https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b7b0b.mp3"></audio>
<audio id="bad" src="https://cdn.pixabay.com/audio/2022/03/15/audio_3c2c1e0c2b.mp3"></audio>
<audio id="bgm" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_c8c8a73467.mp3"></audio>
<audio id="bossbgm" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_5d3c6f7c1e.mp3"></audio>

<script>
let score,time,level;
let fishInt,timerInt,bubbleInt;
let boss=false;

const game=document.getElementById("game");
const overlay=document.getElementById("overlay");

const good=document.getElementById("good");
const bad=document.getElementById("bad");
const bgm=document.getElementById("bgm");
const bossbgm=document.getElementById("bossbgm");

function popup(x,y,val){
 const p=document.createElement("div");
 p.className="score-popup "+(val>0?"plus":"minus");
 p.textContent=(val>0?"+":"")+val;
 p.style.left=x+"px";
 p.style.top=y+"px";
 game.appendChild(p);
 setTimeout(()=>p.remove(),1000);
}

function spawn(){
 const fish=document.createElement("div");
 fish.className="fish";

 const list=["??","??","??","??","??","??","??","??"];
 const emoji=list[Math.floor(Math.random()*list.length)];
 fish.textContent=emoji;

 let x=Math.random()*window.innerWidth;
 let y=Math.random()*window.innerHeight;
 fish.style.left=x+"px";
 fish.style.top=y+"px";

 game.appendChild(fish);

 let sx=(Math.random()*4-2);
 let sy=(Math.random()*4-2);

 const move=setInterval(()=>{
  x+=sx; y+=sy;
  if(x<0||x>innerWidth-50)sx*=-1;
  if(y<0||y>innerHeight-50)sy*=-1;
  fish.style.left=x+"px";
  fish.style.top=y+"px";
 },30);

 fish.addEventListener("touchstart",tap);
 fish.addEventListener("click",tap);

 function tap(e){
  let val=1;
  if(emoji==="??")val=5;
  if(emoji==="??")val=-3;

  score+=val;
  if(score<0)score=0;

  popup(x,y,val);
  (val>0?good:bad).play();

  fish.remove();
  clearInterval(move);
 }

 setTimeout(()=>{fish.remove(); clearInterval(move);},3000);
}

function bubble(){
 const b=document.createElement("div");
 b.className="bubble";
 b.textContent="○";
 b.style.left=Math.random()*innerWidth+"px";
 b.style.animationDuration=(3+Math.random()*3)+"s";
 game.appendChild(b);
 setTimeout(()=>b.remove(),6000);
}

function bossSpawn(){
 if(boss)return;
 boss=true;

 bgm.pause();
 bossbgm.play();

 const b=document.createElement("div");
 b.textContent="??";
 b.style.fontSize="120px";
 b.style.position="absolute";

 let hp=5,x=100,y=100;
 game.appendChild(b);

 const m=setInterval(()=>{
  x+=3; y+=2;
  b.style.left=x+"px";
  b.style.top=y+"px";
 },30);

 b.addEventListener("touchstart",hit);
 b.addEventListener("click",hit);

 function hit(e){
  hp--;
  if(hp<=0){
   score+=20;
   popup(x,y,20);
   b.remove();
   clearInterval(m);
   boss=false;
   bossbgm.pause();
   bgm.play();
  }
 }
}

function startGame(){
 score=0;
 time=30;
 level=1;
 overlay.style.display="none";

 bgm.currentTime=0;
 bgm.play();

 fishInt=setInterval(spawn,800);
 timerInt=setInterval(()=>{
  time--;
  document.getElementById("timer").textContent=time;

  if(time%5===0){
   level++;
   document.getElementById("level").textContent="Lv"+level;
   clearInterval(fishInt);
   fishInt=setInterval(spawn,Math.max(200,800-level*100));
  }

  if(time===15)bossSpawn();

  if(time<=0)end();
 },1000);

 bubbleInt=setInterval(bubble,300);
}

function end(){
 clearInterval(fishInt);
 clearInterval(timerInt);
 clearInterval(bubbleInt);

 bgm.pause();
 bossbgm.pause();

 overlay.style.display="flex";
 overlay.innerHTML=`
  <h1>終了！</h1>
  <p>スコア:${score}</p>
  <button onclick="location.reload()">もう一回</button>
 `;
}
</script>

</body>
</html>